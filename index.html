<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Catatan Keuangan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: Arial; background:#f5f5f5; margin:0 }
    .container { max-width:1100px; margin:auto; padding:15px }
    input, select, button {
      width:100%; padding:10px; margin:5px 0;
    }
    button { background:#4CAF50; color:white; border:none; cursor:pointer }
    table { width:100%; border-collapse:collapse; background:white }
    th, td { padding:8px; border:1px solid #ddd; text-align:center }
    th { background:#4CAF50; color:white }
    .table-wrap { overflow-x:auto }
    .flex { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:10px }
  </style>
</head>

<body>
<div class="container">
  <h2>ðŸ“Š Catatan Keuangan</h2>

  <!-- FORM -->
  <div class="flex">
    <select id="user">
      <option value="">User</option>
      <option>Iqbal</option>
      <option>Balfi</option>
    </select>

    <input type="date" id="tanggal">

    <select id="kategori">
      <option value="">Kategori</option>
      <option>Harian</option>
      <option>Bulanan</option>
    </select>

    <select id="jenis">
      <option value="">Jenis</option>
      <option>Masuk</option>
      <option>Keluar</option>
    </select>

    <input type="number" id="nominal" placeholder="Nominal">
    <input type="text" id="ket" placeholder="Keterangan">
  </div>

  <button onclick="simpan()">ðŸ’¾ Simpan</button>

  <hr>

  <!-- FILTER -->
  <div class="flex">
    <select id="filterUser" onchange="loadData()">
      <option value="">Semua User</option>
      <option>Iqbal</option>
      <option>Balfi</option>
    </select>

    <select id="filterKategori" onchange="loadData()">
      <option value="">Semua Kategori</option>
      <option>Harian</option>
      <option>Bulanan</option>
    </select>

    <select id="limit" onchange="loadData()">
      <option value="10">10</option>
      <option value="25">25</option>
      <option value="50">50</option>
    </select>
  </div>

  <br>

  <!-- TABLE -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>User</th><th>Tanggal</th><th>Kategori</th>
          <th>Jenis</th><th>Rp</th><th>Ket</th><th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxkVKfv8laCfROie4os_5ByY_Qnx34SdMBgEqWKShifGlEf8ml_7O2I27ViQHppg6Jtpg/exec";

/* LOAD DATA */
async function loadData() {
  const fUser = filterUser.value;
  const fKategori = filterKategori.value;
  const limit = limit.value;

  const res = await fetch(`${API}?action=get&user=${fUser}&kategori=${fKategori}&limit=${limit}`);
  const data = await res.json();

  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  data.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td>${r.user}</td>
        <td>${r.tanggal}</td>
        <td>${r.kategori}</td>
        <td>${r.jenis}</td>
        <td>${Number(r.nominal).toLocaleString()}</td>
        <td>${r.ket}</td>
        <td>
          <button onclick="hapus('${r.id}')">ðŸ—‘</button>
        </td>
      </tr>`;
  });
}

/* SIMPAN */
async function simpan() {
  const payload = {
    user: user.value,
    tanggal: tanggal.value,
    kategori: kategori.value,
    jenis: jenis.value,
    nominal: nominal.value,
    ket: ket.value
  };

  await fetch(API, {
    method:"POST",
    body: JSON.stringify(payload)
  });

  loadData();
}

async function hapus(id) {
  await fetch(`${API}?action=delete&id=${id}`);
  loadData();
}

loadData();
</script>
</body>
</html>
